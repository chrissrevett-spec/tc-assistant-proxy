 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/public/widget.html b/public/widget.html
index ce8a32779ac396884a55c0c7dd8ac36922b92044..e20776ce2cee68758102ba697aa53bc4919ba19e 100644
--- a/public/widget.html
+++ b/public/widget.html
@@ -24,51 +24,56 @@
       <div style="display:flex; flex-direction:column; gap:8px;">
         <button id="tc-ask-stream">Ask (stream)</button>
         <button id="tc-ask-json">Ask (non-stream)</button>
         <button id="tc-clear">Clear</button>
       </div>
     </div>
     <div id="out"></div>
   </div>
 
   <script>
   (function () {
     // IMPORTANT: no automatic POST on load.
     // User must click one of the buttons.
 
     const API_BASE = location.origin.replace(/\/$/, ""); // tc-assistant-proxy.vercel.app
     const $in   = document.getElementById("tc-input");
     const $out  = document.getElementById("out");
     const $stat = document.getElementById("status");
     const $btnS = document.getElementById("tc-ask-stream");
     const $btnJ = document.getElementById("tc-ask-json");
     const $btnC = document.getElementById("tc-clear");
 
     let currentThreadId = null;
 
     function setStatus(t){ $stat.textContent = t || ""; }
-    function append(t){ $out.textContent += t; }
+    function append(t){
+      // Ensure we always append text. If an object sneaks through, convert it
+      // to a string so the UI doesn't render "[object Object]" repeatedly.
+      if (t === undefined || t === null) return;
+      $out.textContent += t.toString();
+    }
     function nl(){ append("\n"); }
     function clearOut(){ $out.textContent = ""; }
 
     async function askJson(prompt) {
       setStatus("Thinking…");
       const r = await fetch(`${API_BASE}/api/assistant?stream=off`, {
         method: "POST",
         headers: { "Content-Type": "application/json", "Accept": "application/json" },
         body: JSON.stringify({ userMessage: prompt, threadId: currentThreadId })
       });
       setStatus("");
       if (!r.ok) { append(`⚠️ HTTP ${r.status}`); nl(); return; }
       const data = await r.json().catch(() => null);
       if (!data || !data.ok) { append("⚠️ Request failed."); nl(); return; }
       if (data.thread_id) currentThreadId = data.thread_id;
       if (data.text) append(data.text + "\n");
     }
 
     async function askStream(prompt) {
       setStatus("Typing…");
       const r = await fetch(`${API_BASE}/api/assistant?stream=on`, {
         method: "POST",
         headers: { "Content-Type": "application/json", "Accept": "text/event-stream" },
         body: JSON.stringify({ userMessage: prompt, threadId: currentThreadId })
       });
 
EOF
)
